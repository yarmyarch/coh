var coh=coh||{};coh.LocalConfig={COLOR:{GREEN:1,RED:2,BLUE:3},LOCATION_TYPE:{1:[1,1],2:[2,1],3:[1,2],4:[2,2]},CONVERT_TYPE:{1:[[1],[1],[1]],2:[[2],[2],[1],[1]],3:[[1,1,1]],4:[[3,3],[1,1]],5:[[4,4],[4,4],[1,1],[1,1]]},STATUS_BLANK:0,STATUS_OCCUPIED:1,COLOR_COUNT:3,BLANK_DATA_GROUP:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],FRAME_RATE:1/60,COLOR_CONFIG:{elf:["blue","white","gold"]},MAP_BATTLE_LAYER_NAME:"battleField",SPRITE_SCALE:{1:1.25,2:1.1,3:1.25,4:1.1},PRE_RAND_ID:"YarRi_"};var coh=coh||{};coh.units={archer:{type:1,priority:10},knight:{type:2,priority:10},paladin:{type:4,priority:10}};var coh=coh||{};coh.res={HelloWorld_png:"res/HelloWorld.png",CloseNormal_png:"res/CloseNormal.png",CloseSelected_png:"res/CloseSelected.png",map:{districts:{forest:"res/tmxmap/forest.tmx"},battle:{field_16X16:"res/tmxmap/battle_16X16.tmx"}},imgs:{market:"res/tmxmap/b_market.jpg",forest:"res/tmxmap/forest.jpg"},sprite:{awen:{walking:{plist:"res/sprite/sprite.plist",img:"res/sprite/imgs/sprite.png"}}}};(function(){var b=function(e){var c=[];for(var d in e){if(e[d] instanceof Object){c=c.concat(b(e[d]))}else{c.push(e[d])}}return c};var a=function(e){var d=coh;for(var c in d.units){e.sprite[c]={};e.sprite[c].idle={plist:"res/sprite/"+c+"_idle.plist",img_0:"res/sprite/imgs/"+c+"_blue.png",img_1:"res/sprite/imgs/"+c+"_gold.png",img_2:"res/sprite/imgs/"+c+"_white.png"}}return e};coh.resources=b(a(coh.res))})();var coh=coh||{};coh.Util=(function(){var a;var b={riList:{0:1}};return a={isExecutable:function(c){return c instanceof Function&&(typeof(c)).toLowerCase()=="function"},popRandom:function(d){var c=~~(Math.random()*d.length);inst=d[c];d[c]=d[d.length-1];d.length-=1;return inst},getRandId:function(){var c=0,d=b;while(d.riList[c]){c=(+(Math.random()+"").substring(2,10)).toString(36)}b[c]=1;return c}}})();var SlideUtil=(function(){var d,a=arguments;var e={interval:false,slides:false,newInstance:false,oriSlides:false};var f={FLOAT_RANGE:0.00002,PARAM:{START:0,END:1,SPEED:2,INTERVAL:3,CALLBACK:4}};var c={getDivisor:function(h,g){if(h<g){var i;i=h;h=g;g=i}while(g!=0){i=h%g;h=g;g=i}return h}};var b={judge:function(h){var g=f;h[g.PARAM.START]=+h[g.PARAM.START];h[g.PARAM.END]=+h[g.PARAM.END];h[g.PARAM.SPEED]=+h[g.PARAM.SPEED];h[g.PARAM.INTERVAL]=Math.abs(+h[g.PARAM.INTERVAL]);h[5]&&(h[5]=+h[5]);h[g.PARAM.INTERVAL]=Math.ceil(h[g.PARAM.INTERVAL]/17)*17;if(isNaN(Math.max(h[g.PARAM.START],h[g.PARAM.END],h[g.PARAM.SPEED],h[g.PARAM.INTERVAL]))){return false}return h},slide:function(){var n=[],o=0,l=e,h=f,m=e.slides=[];var j;for(var k=0,g=arguments.length;k<g;++k){j=b.judge(arguments[k]);if(!j){continue}m.push(j);o=o||j[h.PARAM.INTERVAL];o=c.getDivisor(o,j[h.PARAM.INTERVAL])}l.newInstance&&(l.oriSlides=m);clearInterval(l.interval);m.length&&(l.interval=setInterval(function(){var r=[],q=true,t=false;for(var s=0,p=m.length;s<p;++s){if(o%m[s][h.PARAM.INTERVAL]!=0||n[s]){q=q&&!!n[s];continue}r[s]=m[s][h.PARAM.END]-m[s][h.PARAM.START];if(r[s]==0||Math.abs(r[s])<=m[s][5]||Math.abs(r[s])<=f.FLOAT_RANGE){n[s]=1;q=q&&!!n[s];(m[s][h.PARAM.CALLBACK] instanceof Function)&&m[s][h.PARAM.CALLBACK](m[s][h.PARAM.END],r[s],!!n[s]);continue}else{n[s]=0;q=q&&!!n[s]}t=m[s][h.PARAM.START]===~~m[s][h.PARAM.START]&&m[s][h.PARAM.END]===~~m[s][h.PARAM.END];m[s][h.PARAM.START]=m[s][h.PARAM.START]+r[s]*m[s][h.PARAM.SPEED];t&&(m[s][h.PARAM.START]=r[s]>0?Math.ceil(m[s][h.PARAM.START]):Math.floor(m[s][h.PARAM.START]));(m[s][h.PARAM.CALLBACK] instanceof Function)&&m[s][h.PARAM.CALLBACK](m[s][h.PARAM.START],r[s],!!n[s])}o+=o;q&&clearInterval(l.interval)},o));l.newInstance=false}};d=function(){var g=e;g.newInstance=1;g.slides=a};d.pause=function(){clearInterval(e.interval)};d.run=function(){var g=e;!!arguments.length&&(g.newInstance=1);if(arguments&&arguments.length){b.slide.apply({},arguments)}else{b.slide(g.slides)}};d.restore=function(){var j=e,g=f;for(var h in j.oriSlides){j.slides[g.PARM.END]=j.oriSlides[g.PARM.START]}b.slide(j.slides)};d.clear=function(){var j=e,g=f;for(var h in j.oriSlides){j.slides[g.PARM.START]=j.oriSlides[g.PARM.START]}};return d})();var coh=coh||{};coh.utils=coh.utils||{};(function(){var a;var b=function(){if(!a){a={getTilePosition:function(f,e,g,d){var c=4+d,h=f?8+g:5-g;return{x:c,y:h}}}}return a};coh.utils.TileSelector_16X16=function(){return b()};coh.utils.TileSelector_16X16.getInstance=b})();var coh=coh||{};coh.utils=coh.utils||{};(function(){var a;var c={baseTransformer:{2:function(e,d){if(!e){d.y-=1}return d},3:function(e,d){if(!e){d.x-=1}return d},4:function(e,d){if(!e){d.y-=1}return d}}};var b=function(d){if(!a){if(!d){return null}a={};for(var e in d){a[e]=d[e]}a.getTilePosition=function(i,h,j,g){var f=d.getTilePosition(i,h,j,g);c.baseTransformer[h]&&(f=c.baseTransformer[h](i,f));return f}}return a};coh.utils.BaseTileTransformer=function(d){return b(d)};coh.utils.BaseTileTransformer.getInstance=b})();var coh=coh||{};coh.utils=coh.utils||{};coh.utils.FilterUtil=(function(){var b;var c={filters:{},activedPriorities:{}};var a={sort:function(e,d){return e-d<=0}};return b={addFilter:function(f,g,e){var d=c,e=(undefined===e)&&10||e;!d.filters[f]&&(d.filters[f]={});!d.activedPriorities[f]&&(d.activedPriorities[f]=[]);if(!d.filters[f][e]){d.filters[f][e]=[];d.activedPriorities[f].push(e);d.activedPriorities[f].sort(a.sort)}(g instanceof Function)&&d.filters[f][e].push(g)},removeFilter:function(h,j,g){var f=c,k,d=[],g=(undefined===g)&&10||g;if(!f.filters[h]){return false}k=f.filters[h][g];for(var e in k){if(k[e]!=j){d.push(k[e])}}f.filters[h][g]=d;return true},applyFilters:function(h,l){var f=c,q,o,d,k=l,p=[],g,e,n,m;if(!f.filters[h]){return k}q=f.activedPriorities[h];for(g=0,n=q.length;g<n;++g){o=f.filters[h][q[g]];for(e=0,m=o.length;e<m;++e){p=[k].concat([].slice.call(arguments,2));(o[e] instanceof Function)&&(k=o[e].apply({},p))}}return k},clearFilters:function(e){var d=c;d.filters[e]={};d.activedPriorities[e]=[]}}})();var coh=coh||{};coh.View=(function(){var a;var b={spriteCache:cc.spriteFrameCache,animations:{},animFrames:{}};return a={moveMap:function(c,i){var h=coh.map,e=h.getPosition(),g=false,d=false;var f=function(){g&&d&&i&&i()};SlideUtil.run([e.x,c.x,0.3,40,function(l,j,k){h.setPosition(l,h.getPosition().y);g=k;f()},0.5],[e.y,c.y,0.3,40,function(l,j,k){h.setPosition(h.getPosition().x,l);d=k;f()},0.5])},setSprite:function(){},locateNode:function(d){var e=coh.map,c=cc.director.getWinSize();e.setPosition(-d.x-d.width/2+c.width/2,-d.y-d.height/2+c.height/2)},moveMapToNode:function(d,f){var e=coh.map,c=cc.director.getWinSize();a.moveMap({x:-d.x-d.width/2+c.width/2,y:-d.y-d.height/2+c.height/2},f)},getSprite:function(c,h,d){var f,k,i=coh,l=cc,g=b.spriteCache,e;var j={rate:d.rate||i.LocalConfig.FRAME_RATE,cons:d.cons||l.Sprite,animMode:d.animMode||l.RepeatForever,color:d.color===undefined?-1:d.color};e="img"+(j.color===-1?"":"_"+(+j.color));f=j.animMode.create(a.getAnimation(c,h,e,j.rate));var k=new j.cons(b.animFrames[c][h][e][0]);k.runAction(f);return k},getAnimation:function(c,f,h,g){var e=b,d=cc;g=g||_coh.LocalConfig.FRAME_RATE;!e.animations[c]&&(e.animations[c]={});!e.animations[c][f]&&(e.animations[c][f]={});!e.animations[c][f][h]&&(e.animations[c][f][h]=d.Animate.create(cc.Animation.create(a.getFrames(c,f,h),g)));return e.animations[c][f][h]},getFrames:function(c,g,k){var f=b,d=f.spriteCache,h=coh,j=[];!f.animFrames[c]&&(f.animFrames[c]={});!f.animFrames[c][g]&&(f.animFrames[c][g]={});if(!f.animFrames[c][g][k]){d.removeSpriteFrames();d.addSpriteFrames(h.res.sprite[c][g].plist,h.res.sprite[c][g][k]);for(var e in d._spriteFrames){j.push(d._spriteFrames[e])}d.removeSpriteFrames();f.animFrames[c][g][k]=j}return f.animFrames[c][g][k]}}})();var coh=coh||{};coh.Actor=cc.Sprite.extend({position:"",ctor:function(c,d,b){this._super(c,d);if(b&&b.name){this.position=b.name;coh.View.locateNode(b)}var a=cc.director.getWinSize();this.setPosition(a.width/2,a.height/2+this.height/4)},goTo:function(b,c){var a=this;a.position="";coh.View.moveMapToNode(b,function(){a.position=b.name;c&&c()})}});var coh=coh||{};(function(){var a=function(c){var d=this,g=coh,f=g.units[c];if(!f){return null}var e={id:0,name:false,level:0,defend:0,attack:0,conf:{}};var b=function(h){var k=e;k.name=h;for(var j in f){k.conf[j]=f[j];d["get"+j[0].toUpperCase()+j.substr(1)]=(function(l){return function(){return e.conf[l]}})(j)}this.id=g.LocalConfig.PRE_RAND_ID+g.Util.getRandId()};d.getName=function(){return e.name};d.getId=function(){return e.id};d.getLevel=function(){return e.level};d.getDefend=function(){return e.defend};d.getAttack=function(){return e.attack};b.apply(d,arguments);return d};coh.Unit=(function(c){var b;return b={getType:function(d){return(coh.units[d]&&coh.units[d].type)||0},getInstance:function(d){return new a(d)}}})()})();var coh=coh||{};(function(){coh.Player=function(e,f,b){var c=this;var d={dataGroup:[],faction:false,level:0,currentHP:0,totalHP:0,isAttacker:true,units:{},unitsUnplaced:{}};var a=function(k,g,p){var i=d,j=coh,o=i.unitsUnplaced,n;for(var h in p){n=j.units[h];if(!n){continue}o[n.priority]=o[n.priority]||{};o[n.priority][n.type]=o[n.priority][n.type]||[];for(var l=0,m=p[h];l<m;++l){o[n.priority][n.type].push(h)}}};c.getUnplacedUnit=function(h){var o=coh,k=d,n=k.unitsUnplaced,l=o.Battle.getTypeFromStatus(h),m=null,g;for(var j in n){if(n[j][l]){g=o.Util.popRandom(n[j][l]);m=o.Unit.getInstance(g);break}}if(!m){return null}k.units[m.getId()]=m;return m};c.killUnit=function(i){var g=d,h=g.units[i];if(h){g.unitsUnplaced[h.getPriority()][h.getType()].push(h.getName());delete (g.units[i])}};c.getUnit=function(g){};c.getDataGroup=function(){return d.dataGroup};c.getCurrentHP=function(){return d.currentHP};c.getTotalHP=function(){return d.totalHP};c.getUnits=function(){return d.units};c.getUnitConfig=function(){return b};c.isAttacker=function(){return d.isAttacker};c.setAsAttacker=function(){d.isAttacker=true};c.setAsDefender=function(){d.isAttacker=false};a.apply(c,arguments);return c}})();var coh=coh||{};coh.Battle=(function(){var self;var LC=coh.LocalConfig;var buf={};var handlerList={locationTest:{1:function(dataGroup,colNum){return dataGroup[dataGroup.length-1][colNum]==LC.STATUS_BLANK},2:function(dataGroup,colNum){return dataGroup[dataGroup.length-1][colNum]==LC.STATUS_BLANK&&dataGroup[dataGroup.length-2][colNum]==LC.STATUS_BLANK},3:function(dataGroup,colNum){return dataGroup[dataGroup.length-1][colNum]==LC.STATUS_BLANK&&+dataGroup[dataGroup.length-1][colNum+1]==LC.STATUS_BLANK},4:function(dataGroup,colNum){return dataGroup[dataGroup.length-1][colNum]==LC.STATUS_BLANK&&dataGroup[dataGroup.length-1][colNum+1]==LC.STATUS_BLANK&&dataGroup[dataGroup.length-2][colNum]==LC.STATUS_BLANK&&dataGroup[dataGroup.length-2][colNum+1]==LC.STATUS_BLANK}}};var util={getBlankIndex:function(dataGroup,colNum){var blank=LC.STATUS_BLANK;for(var i=dataGroup.length-1;i>=0;--i){if(+dataGroup[i][colNum]!=blank){return i+1}}return 0},findConvert:function(dataGroup,colNum,rowNum,color){var _lc=LC,convert,match,result=[];for(var i in _lc.CONVERT_TYPE){convert=_lc.CONVERT_TYPE[i];match=true;if(convert.length>rowNum+1||convert[0].length>colNum+1){continue}for(var rowInCon=convert.length-1,queue;queue=convert[rowInCon];--rowInCon){for(var colInQueue=queue.length-1,status;status=queue[colInQueue];--colInQueue){if(rowInCon==convert.length-1&&colInQueue==queue.length-1){continue}status=status*_lc.COLOR_COUNT+color;match=match&&(+status==+dataGroup[rowNum+1-convert.length+rowInCon][colNum+1-queue.length+colInQueue]);if(!match){break}}if(!match){break}}if(match){result.push(i)}}return result},locationTest:function(dataGroup,type,colNum){return handlerList.locationTest[type](dataGroup,colNum)},colorTest:function(dataGroup,type,colNum,color){if(type!=1){return true}if(self.findAllPossibleConverts(dataGroup,colNum,util.getBlankIndex(dataGroup,colNum),color).length){return false}return true},checkResultSet:function(resultSet,targetArray,rowNum){if(!resultSet[rowNum]){var rowCount=0;while(rowCount<=rowNum){resultSet.push(eval("["+targetArray.join(",").replace(/\d+/g,0)+"]"));++rowCount}}return resultSet},copy2Array:function(arr){var arrBuf=arr.concat();for(var i=0,row;row=arr[i];++i){arrBuf[i]=arrBuf[i].concat()}return arrBuf}};return self={getTypeFromStatus:function(status){return ~~(status/LC.COLOR_COUNT)},getColorFromStatus:function(status){return status%LC.COLOR_COUNT},generate:function(attacker,defender){},recharge:function(current,config){var result=[],faild=[],currentBuf=util.copy2Array(current);totalCount=0,items=[],_lc=LC,_coh=coh,_buf=buf,_util=util;for(var i in config){totalCount+=config[i];for(var j=0;j<config[i];++j){items.push(i)}}var targetType,totalColumns=currentBuf[0].length,column,columnCount,color,colorCount,match=true;_buf.occupiedRowIndex={};while(items.length>0){targetType=_coh.Util.popRandom(items);if(!_lc.LOCATION_TYPE[targetType]){continue}columnCount=0;colorCount=0;do{if(columnCount==0){column=~~(Math.random()*totalColumns)}else{column=(column+1)%totalColumns}++columnCount}while(columnCount<=totalColumns&&!(match=_util.locationTest(currentBuf,targetType,column)));if(match){do{if(colorCount==0){color=~~(Math.random()*_lc.COLOR_COUNT)}else{color=(color+1)%_lc.COLOR_COUNT}++colorCount}while(colorCount<=_lc.COLOR_COUNT&&!(match=_util.colorTest(currentBuf,targetType,column,color)))}if(!match){faild.push(targetType)}else{var typeConfig=_lc.LOCATION_TYPE[targetType],blankIndex=0,rBlankIndex=0;for(var rowCount=0;rowCount<typeConfig[0];++rowCount){for(var columnCount=0;columnCount<typeConfig[1];++columnCount){blankIndex=Math.max(blankIndex,_util.getBlankIndex(currentBuf,column+columnCount));rBlankIndex=Math.max(blankIndex,_util.getBlankIndex(result,column+columnCount))}for(var columnCount=0;columnCount<typeConfig[1];++columnCount){result=_util.checkResultSet(result,currentBuf[0],rBlankIndex);result[rBlankIndex][column+columnCount]=(rowCount==0&&columnCount==0?(targetType*_lc.COLOR_COUNT+color):_lc.STATUS_OCCUPIED);currentBuf[blankIndex][column+columnCount]=targetType*_lc.COLOR_COUNT+color}}}}return{succeed:result,faild:faild,dataGroup:currentBuf}},findAllPossibleConverts:function(dataGroup,colNum,rowNum,color){var columnPointer=colNum,convertList,result=[],_lc=LC,_util=util,status=1*_lc.COLOR_COUNT+color,dataBuf=_util.copy2Array(dataGroup);dataBuf[rowNum][colNum]=status;while(columnPointer>=0&&+dataBuf[rowNum][columnPointer]==+status){convertList=_util.findConvert(dataBuf,columnPointer,rowNum,color);convertList.length&&result.push({column:columnPointer,row:rowNum,converts:convertList});--columnPointer}columnPointer=colNum+1;while(columnPointer<dataBuf[0].length&&+dataBuf[rowNum][columnPointer]==+status){convertList=_util.findConvert(dataBuf,columnPointer,rowNum,color);convertList.length&&result.push({column:columnPointer,row:rowNum,converts:convertList});++columnPointer}return result}}})();var coh=coh||{};coh.MapScene=cc.Scene.extend({onEnter:function(){this._super();var a=new coh.MapLayer();this.addChild(a)}});var coh=coh||{};coh.MapLayer=cc.Layer.extend({sprite:null,ctor:function(){this._super();var f=coh;f.map=cc.TMXTiledMap.create(f.res.map.districts.forest);this.addChild(f.map,0,1);var c=cc.director.getWinSize(),b=this,e=f.map.getObjectGroup("positions"),g={},d=function(i){var h;if((h=e.objectNamed(b.sprite.position))&&(h=h[g[i]])&&(h=e.objectNamed(h))){b.sprite.goTo(h,function(){if(h.passingBy){setTimeout(function(){d(i)},0)}})}else{return}},a=function(){f.scene.battle=f.scene.battle||(f.scene.battle=new f.BattleScene(f.res.map.battle.field_16X16,f.res.imgs.market));f.scene.battle.setTileSelector(f.utils.BaseTileTransformer.getInstance(f.utils.TileSelector_16X16.getInstance()));cc.director.runScene(cc.TransitionFadeDown.create(1.2,f.scene.battle));setTimeout(function(){f.scene.battle.generate();f.scene.battle.generate(1)},0)};g[cc.KEY.left]="left";g[cc.KEY.right]="right";g[cc.KEY.up]="up";g[cc.KEY.down]="down";if(cc.sys.capabilities.hasOwnProperty("keyboard")){cc.eventManager.addListener({event:cc.EventListener.KEYBOARD,onKeyPressed:function(h,i){if(h==cc.KEY.left||h==cc.KEY.right||h==cc.KEY.up||h==cc.KEY.down){d(h)}if(h==cc.KEY.enter){a()}},onKeyReleased:function(h,i){}},this)}b.sprite=f.View.getSprite("awen","walking",{cons:function(h,i){return new f.Actor(h,i,e.objectNamed("first"))}});this.addChild(b.sprite);return true}});var coh=coh||{};coh.BattleScene=function(){var self;var buf={tmxList:{},bgList:{}};var handlerList={tileSelector:null};var argList=[];for(var i=0,arg;arg=arguments[i];++i){argList.push("arguments["+i+"]")}argList=argList.join(",");var BSClass=cc.Scene.extend({battleLayer:null,battleField:null,battleMap:null,ctor:function(mapSrc,imgSrc){this._super();this.battleLayer=new cc.Layer();this.setBattleField(imgSrc);this.setBattleMap(mapSrc);this.addChild(this.battleLayer)},onEnter:function(){coh.utils.FilterUtil.applyFilters("battleSceneEntered",this)},setBattleField:function(imgSrc){if(!imgSrc){return}var _buf=buf;if(!_buf.bgList[imgSrc]){var sprite=cc.Sprite.create(imgSrc),winSize=cc.director.getWinSize();sprite.attr({anchorX:0.5,anchorY:0.5,scale:winSize.height/sprite.height,x:winSize.width/2,y:winSize.height/2});_buf.bgList[imgSrc]=sprite}if(this.battleField){this.battleLayer.removeChild(this.battleField)}this.battleLayer.addChild(_buf.bgList[imgSrc],0);this.battleField=_buf.bgList[imgSrc]},setBattleMap:function(mapSrc){if(!mapSrc){return}var _buf=buf;if(!_buf.tmxList[mapSrc]){var map=cc.TMXTiledMap.create(mapSrc),winSize=cc.director.getWinSize();map.attr({anchorX:0.5,anchorY:0.5,scale:winSize.height/map.height,x:winSize.width/2,y:winSize.height/2});_buf.tmxList[mapSrc]=map}if(this.battleMap){this.battleLayer.removeChild(this.battleMap)}this.battleLayer.addChild(_buf.tmxList[mapSrc],1);this.battleMap=_buf.tmxList[mapSrc]},setTileSelector:function(selector){handlerList.tileSelector=selector},getUnitSprite:function(x,y){},generate:function(isDefender){var player=new coh.Player("",1,{archer:24,knight:4,paladin:2});isDefender=isDefender?"setAsDefender":"setAsAttacker";player[isDefender]();this.placePlayer(player)},placePlayer:function(player){var unitConfig={},units=player.getUnitConfig(),_coh=coh;var unitType;for(var unitName in units){unitType=_coh.Unit.getType(unitName);unitConfig[unitType]||(unitConfig[unitType]=0);unitConfig[unitType]+=units[unitName]}var recharge=_coh.Battle.recharge(_coh.LocalConfig.BLANK_DATA_GROUP,unitConfig);for(var i=0,row;row=recharge.succeed[i];++i){for(var j=0,status;(status=row[j])!=undefined;++j){status&&_coh.Battle.getTypeFromStatus(status)&&this.placeUnit(player,status,i,j)}}},placeUnit:function(player,status,rowNum,colNum){var _coh=coh,unit=player.getUnplacedUnit(status),unitSprite=_coh.View.getSprite(unit.getName(),"idle",{color:status%_coh.LocalConfig.COLOR_COUNT}),tilePosition=handlerList.tileSelector.getTilePosition(player.isAttacker(),_coh.Battle.getTypeFromStatus(status),rowNum,colNum),tile=this.battleMap.getLayer(_coh.LocalConfig.MAP_BATTLE_LAYER_NAME).getTileAt(tilePosition);unitSprite.attr({x:tile.x,y:tile.y,scale:_coh.LocalConfig.SPRITE_SCALE[unit.getType()],anchorX:0,anchorY:1});this.battleMap.addChild(unitSprite,tilePosition.y);_coh.unitList=_coh.unitList||[];_coh.unitList.push(unitSprite)}});return self=eval("new BSClass("+argList+")")};(function(){coh.utils.FilterUtil.addFilter("battleSceneEntered",function(a){if("mouse" in cc.sys.capabilities){cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseMove:function(d){var b=d.getLocation(),c=a.getUnitSprite(b.x,b.y)}},a)}})})();